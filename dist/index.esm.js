import e,{useState as t,useRef as n,useEffect as r,useCallback as o}from"react";import{Paper as i,Box as a,Typography as l,TextField as c,Button as u,Divider as m,Tooltip as s,IconButton as d}from"@material-ui/core";import{makeStyles as f}from"@material-ui/core/styles";import{FormatBold as p,FormatItalic as g,FormatUnderlined as v,StrikethroughS as h,Link as x,FormatClear as y}from"@mui/icons-material";var b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;document.execCommand(e,!1,t)},C=function(){var e=window.getSelection();if(!e||0===e.rangeCount)return null;var t=e.getRangeAt(0);return{selection:e,range:t.cloneRange(),text:e.toString(),isCollapsed:e.isCollapsed}},E=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=window.getSelection();if(t&&(n.removeAllRanges(),n.addRange(t)),n.isCollapsed){var r=document.createElement("a");r.href=e,r.textContent=e,r.target="_blank",r.rel="noopener noreferrer",t.insertNode(r),t.setStartAfter(r),t.setEndAfter(r),n.removeAllRanges(),n.addRange(t)}else{document.execCommand("createLink",!1,e),document.querySelectorAll('a[href="'+e+'"]').forEach(function(e){e.target="_blank",e.rel="noopener noreferrer"})}},k=function(){document.execCommand("unlink")},S=function(e){return document.queryCommandState(e)},w=function(){return document.queryCommandValue("formatBlock")},L=function(e){var t=window.getSelection();if(t.rangeCount>0){var n=t.getRangeAt(0);n.deleteContents();var r=document.createElement("div");r.innerHTML=e;for(var o=document.createDocumentFragment();r.firstChild;)o.appendChild(r.firstChild);n.insertNode(o),n.collapse(!1),t.removeAllRanges(),t.addRange(n)}},R=function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""},A=function(e){var t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll("p:empty, div:empty").forEach(function(e){return e.remove()}),t.querySelectorAll("[style]").forEach(function(e){return e.removeAttribute("style")}),t.innerHTML};function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function B(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var I=function(o){var m=o.position,s=o.onSubmit,d=o.onClose,f=o.initialValue,p=void 0===f?"":f,g=o.isEdit,v=void 0!==g&&g,h=B(t(p),2),x=h[0],y=h[1],b=n(null);r(function(){y(p),setTimeout(function(){"function"==typeof b.current.focus&&b.current.focus(),"function"==typeof b.current.select&&b.current.select()},50)},[p]);return e.createElement(i,{elevation:4,sx:{position:"absolute",left:m.x,top:m.y,transform:"translateX(-50%)",zIndex:1e3,p:2,minWidth:320,maxWidth:400}},e.createElement(a,{component:"form",onSubmit:function(e){if(e.preventDefault(),x.trim()){var t=x.trim();t.match(/^https?:\/\//)||(t="https://"+t),s(t)}},sx:{display:"flex",flexDirection:"column",gap:2}},e.createElement(l,{variant:"subtitle2",sx:{fontWeight:600}},v?"Edit Link":"Insert Link"),e.createElement(c,{inputRef:b,fullWidth:!0,size:"small",value:x,onChange:function(e){return y(e.target.value)},onKeyDown:function(e){"Escape"===e.key&&d()},placeholder:"Enter URL (e.g., https://example.com)",variant:"outlined"}),e.createElement(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"}},e.createElement(a,{sx:{display:"flex",gap:1}},e.createElement(u,{type:"submit",variant:"contained",size:"small",disabled:!x.trim(),sx:{textTransform:"none"}},v?"Update":"Insert"),e.createElement(u,{type:"button",variant:"outlined",size:"small",onClick:d,sx:{textTransform:"none"}},"Cancel")),v&&e.createElement(u,{type:"button",variant:"contained",color:"error",size:"small",onClick:function(){document.execCommand("unlink"),d()},sx:{textTransform:"none"}},"Remove"))))},H=function(t){var n=t.onFormat,r=t.showStrikethrough,o=void 0!==r&&r,i=t.showCleanFormat,l=[{command:"bold",icon:p,title:"Bold (Ctrl+B)",group:"text"},{command:"italic",icon:g,title:"Italic (Ctrl+I)",group:"text"},{command:"underline",icon:v,title:"Underline (Ctrl+U)",group:"text"},o&&{command:"strikeThrough",icon:h,title:"Strikethrough (Ctrl+S)",group:"text"},{command:"createLink",icon:x,title:"Insert Link (Ctrl+K)",group:"link"},void 0!==i&&i&&{command:"removeFormat",icon:y,title:"Remove Formatting (Ctrl+E)",group:"clean"}].filter(Boolean),c=function(e,t){n(e,t)};return e.createElement(a,{sx:{p:"4px",display:"flex",flexWrap:"wrap",alignItems:"center",gap:.5}},e.createElement(a,{sx:{display:"flex",alignItems:"center",gap:.5}},[{command:"formatBlock",value:"h1",label:"H1",group:"heading"},{command:"formatBlock",value:"h2",label:"H2",group:"heading"},{command:"formatBlock",value:"h3",label:"H3",group:"heading"},{command:"formatBlock",value:"p",label:"P",group:"heading"}].map(function(t){var n=t.command,r=t.value,o=t.label;return e.createElement(u,{key:"".concat(n,"-").concat(r),onClick:function(){return c(n,r)},size:"small",variant:"text",sx:{minWidth:"auto",px:1,py:.5,fontSize:"h1"===r?"1.1rem":"h2"===r?"1rem":"0.875rem",fontWeight:null!=r&&r.startsWith("h")?"bold":"normal",color:"#666","&:hover":{bgcolor:"#e0e0e0"},"&:active":{bgcolor:"#d5d5d5"}}},o)})),e.createElement(m,{orientation:"vertical",flexItem:!0,sx:{mx:1}}),e.createElement(a,{sx:{display:"flex",alignItems:"center",gap:.5}},l.map(function(t){var n=t.command,r=t.icon,o=t.title;return e.createElement(s,{key:n,title:o},e.createElement(d,{onClick:function(){return c(n)},size:"small",sx:{"&:hover":{bgcolor:"#e0e0e0"},"&:active":{bgcolor:"#d5d5d5"}}},e.createElement(r,{fontSize:"medium"})))})),e.createElement(m,{orientation:"vertical",flexItem:!0,sx:{mx:1}}),e.createElement(a,{sx:{display:"flex",alignItems:"center",gap:.5}},[{command:"insertUnorderedList",label:"â€¢ List",group:"list"},{command:"insertOrderedList",label:"1. List",group:"list"},{command:"formatBlock",value:"blockquote",label:"Quote",group:"list"}].map(function(t){var n=t.command,r=t.value,o=t.label;return e.createElement(u,{key:"".concat(n,"-").concat(r||"default"),onClick:function(){return c(n,r)},size:"small",variant:"text",sx:{px:1,py:.5,fontSize:"0.875rem",color:"#666","&:hover":{bgcolor:"#e0e0e0"},"&:active":{bgcolor:"#d5d5d5"}}},o)})))},z=f(function(e){return{paper:{border:"1px solid #e0e0e0",borderRadius:e.spacing(1),overflow:"hidden","&:focus-within":{borderColor:e.palette.primary.main}},editor:{padding:e.spacing(2),outline:"none","& p":{margin:"".concat(e.spacing(1),"px 0"),"&:first-child":{marginTop:0},"&:last-child":{marginBottom:0}},"& h1":{fontSize:"2rem",fontWeight:"bold",margin:"".concat(e.spacing(1.5),"px 0")},"& h2":{fontSize:"1.5rem",fontWeight:"bold",margin:"".concat(e.spacing(1),"px 0")},"& h3":{fontSize:"1.25rem",fontWeight:"bold",margin:"".concat(e.spacing(1),"px 0")},"& ul":{listStyle:"disc",paddingLeft:e.spacing(3),margin:"".concat(e.spacing(1),"px 0")},"& ol":{listStyle:"decimal",paddingLeft:e.spacing(3),margin:"".concat(e.spacing(1),"px 0")},"& li":{margin:"".concat(e.spacing(.5),"px 0")},"& blockquote":{borderLeft:"4px solid #ccc",paddingLeft:e.spacing(2),fontStyle:"italic",margin:"".concat(e.spacing(2),"px 0"),color:"#666"},"& a":{color:e.palette.primary.main,textDecoration:"underline","&:hover":{color:e.palette.primary.dark}},"& strong":{fontWeight:"bold"},"& em":{fontStyle:"italic"},"& u":{textDecoration:"underline"}},placeholder:{position:"absolute",top:16,left:16,color:"#999",pointerEvents:"none",userSelect:"none"}}}),D=function(l){var c=l.name,u=void 0===c?"":c,m=l.value,s=void 0===m?"":m,d=l.onChange,f=void 0===d?function(){}:d,p=l.placeholder,g=void 0===p?"Start typing...":p,v=l.maxChars,h=void 0===v?null:v,x=l.height,y=void 0===x?"auto":x,C=l.minHeight,k=void 0===C?"150px":C,S=l.maxHeight,w=void 0===S?null:S,L=l.sx,T=void 0===L?{}:L,D=l.style,W=z(),F=n(null),M=B(t(!1),2),q=M[0],N=M[1],U=B(t({x:0,y:0}),2),j=U[0],K=U[1],O=B(t(""),2),V=O[0],_=O[1],P=B(t(!1),2),Q=P[0],X=P[1],Y=B(t(null),2),$=Y[0],G=Y[1],J=B(t(!1),2),Z=J[0],ee=J[1];r(function(){F.current&&s!==F.current.innerHTML&&(F.current.innerHTML=s)},[s]);var te=o(function(){if(F.current&&f){var e=F.current.innerHTML;if(h){var t=R(e);t.length>h&&(e=A(t.slice(0,h)),F.current.innerHTML=e)}f({target:{name:u,value:e}})}},[f,u,h]),ne=o(function(e,t){var n;if("createLink"!==e){if("removeFormat"===e)return document.execCommand("removeFormat",!1,null),void te();b(e,t),"function"==typeof(null==F||null===(n=F.current)||void 0===n?void 0:n.focus)&&F.current.focus(),te()}else{var r=window.getSelection();if(r&&!r.isCollapsed){var o,i=r.getRangeAt(0).cloneRange();G(i);var a=i.getBoundingClientRect(),l=null===(o=F.current)||void 0===o?void 0:o.getBoundingClientRect();l&&(K({x:a.left-l.left+a.width/2,y:a.bottom-l.top+5}),_(""),X(!1),N(!0))}else{var c=null==r?void 0:r.getRangeAt(0);if(c){var u;G(c.cloneRange());var m=c.getBoundingClientRect(),s=null===(u=F.current)||void 0===u?void 0:u.getBoundingClientRect();s&&(K({x:m.left-s.left,y:m.bottom-s.top+5}),_(""),X(!1),N(!0))}}}},[te]),re=o(function(e){var t;E(e,$||void 0),N(!1),G(null),"function"==typeof(null==F||null===(t=F.current)||void 0===t?void 0:t.focus)&&F.current.focus(),te()},[te,$]),oe=o(function(e){var t=e.target;if("A"===t.tagName){var n;e.preventDefault();var r=t.getBoundingClientRect(),o=null===(n=F.current)||void 0===n?void 0:n.getBoundingClientRect();o&&(K({x:r.left-o.left+r.width/2,y:r.bottom-o.top+5}),_(t.getAttribute("href")||""),X(!0),N(!0))}else N(!1)},[]),ie=o(function(e){if(e.ctrlKey||e.metaKey)switch(e.key){case"b":e.preventDefault(),ne("bold");break;case"i":e.preventDefault(),ne("italic");break;case"u":e.preventDefault(),ne("underline");break;case"k":e.preventDefault(),ne("createLink");break;case"s":e.preventDefault(),ne("strikeThrough");break;case"e":e.preventDefault(),ne("removeFormat")}"Escape"===e.key&&(N(!1),G(null))},[ne]),ae=R(s),le=h?h-ae.length:null;return e.createElement(i,{elevation:1,className:W.paper,style:D,sx:T},e.createElement(H,{onFormat:ne,showStrikethrough:!0,showCleanFormat:!0}),e.createElement(a,{style:{position:"relative"}},e.createElement(a,{ref:F,contentEditable:!0,onFocus:function(){return ee(!0)},onBlur:function(){return ee(!1)},onInput:te,onClick:oe,onKeyDown:ie,className:W.editor,style:{minHeight:k,height:y,maxHeight:w,overflowY:w?"auto":void 0},suppressContentEditableWarning:!0}),(!F.current||""===F.current.innerHTML)&&!Z&&e.createElement(a,{className:W.placeholder},g),q&&e.createElement(I,{position:j,onSubmit:re,onClose:function(){N(!1),G(null)},initialValue:V,isEdit:Q}),h&&e.createElement(a,{sx:{position:"absolute",right:8,bottom:4,fontSize:"0.75rem",color:le<0?"error.main":"text.secondary",pointerEvents:"none"}},le," characters remaining")))};export{b as applyFormatting,A as cleanHTML,D as default,w as getCurrentBlockFormat,R as getPlainText,C as getSelectionInfo,L as insertHTML,E as insertLink,S as isFormatActive,k as removeLink};
//# sourceMappingURL=index.esm.js.map
