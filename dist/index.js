"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@material-ui/core"),n=require("@material-ui/core/styles"),r=require("@mui/icons-material");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=o(e),l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;document.execCommand(e,!1,t)},i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=window.getSelection();if(t&&(n.removeAllRanges(),n.addRange(t)),n.isCollapsed){var r=document.createElement("a");r.href=e,r.textContent=e,r.target="_blank",r.rel="noopener noreferrer",t.insertNode(r),t.setStartAfter(r),t.setEndAfter(r),n.removeAllRanges(),n.addRange(t)}else{document.execCommand("createLink",!1,e),document.querySelectorAll('a[href="'+e+'"]').forEach(function(e){e.target="_blank",e.rel="noopener noreferrer"})}},c=function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""},u=function(e){var t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll("p:empty, div:empty").forEach(function(e){return e.remove()}),t.querySelectorAll("[style]").forEach(function(e){return e.removeAttribute("style")}),t.innerHTML};function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,l,i=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var m=function(n){var r=n.position,o=n.onSubmit,l=n.onClose,i=n.initialValue,c=void 0===i?"":i,u=n.isEdit,d=void 0!==u&&u,m=s(e.useState(c),2),f=m[0],p=m[1],g=e.useRef(null);e.useEffect(function(){p(c),setTimeout(function(){"function"==typeof g.current.focus&&g.current.focus(),"function"==typeof g.current.select&&g.current.select()},50)},[c]);return a.default.createElement(t.Paper,{elevation:4,sx:{position:"absolute",left:r.x,top:r.y,transform:"translateX(-50%)",zIndex:1e3,p:2,minWidth:320,maxWidth:400}},a.default.createElement(t.Box,{component:"form",onSubmit:function(e){if(e.preventDefault(),f.trim()){var t=f.trim();t.match(/^https?:\/\//)||(t="https://"+t),o(t)}},sx:{display:"flex",flexDirection:"column",gap:2}},a.default.createElement(t.Typography,{variant:"subtitle2",sx:{fontWeight:600}},d?"Edit Link":"Insert Link"),a.default.createElement(t.TextField,{inputRef:g,fullWidth:!0,size:"small",value:f,onChange:function(e){return p(e.target.value)},onKeyDown:function(e){"Escape"===e.key&&l()},placeholder:"Enter URL (e.g., https://example.com)",variant:"outlined"}),a.default.createElement(t.Box,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"}},a.default.createElement(t.Box,{sx:{display:"flex",gap:1}},a.default.createElement(t.Button,{type:"submit",variant:"contained",size:"small",disabled:!f.trim(),sx:{textTransform:"none"}},d?"Update":"Insert"),a.default.createElement(t.Button,{type:"button",variant:"outlined",size:"small",onClick:l,sx:{textTransform:"none"}},"Cancel")),d&&a.default.createElement(t.Button,{type:"button",variant:"contained",color:"error",size:"small",onClick:function(){document.execCommand("unlink"),l()},sx:{textTransform:"none"}},"Remove"))))},f=function(e){var n=e.onFormat,o=e.showStrikethrough,l=void 0!==o&&o,i=e.showCleanFormat,c=void 0!==i&&i,u=[{command:"bold",icon:r.FormatBold,title:"Bold (Ctrl+B)",group:"text"},{command:"italic",icon:r.FormatItalic,title:"Italic (Ctrl+I)",group:"text"},{command:"underline",icon:r.FormatUnderlined,title:"Underline (Ctrl+U)",group:"text"},l&&{command:"strikeThrough",icon:r.StrikethroughS,title:"Strikethrough (Ctrl+S)",group:"text"},{command:"createLink",icon:r.Link,title:"Insert Link (Ctrl+K)",group:"link"},c&&{command:"removeFormat",icon:r.FormatClear,title:"Remove Formatting (Ctrl+E)",group:"clean"}].filter(Boolean),d=function(e,t){n(e,t)};return a.default.createElement(t.Box,{sx:{p:"4px",display:"flex",flexWrap:"wrap",alignItems:"center",gap:.5}},a.default.createElement(t.Box,{sx:{display:"flex",alignItems:"center",gap:.5}},[{command:"formatBlock",value:"h1",label:"H1",group:"heading"},{command:"formatBlock",value:"h2",label:"H2",group:"heading"},{command:"formatBlock",value:"h3",label:"H3",group:"heading"},{command:"formatBlock",value:"p",label:"P",group:"heading"}].map(function(e){var n=e.command,r=e.value,o=e.label;return a.default.createElement(t.Button,{key:"".concat(n,"-").concat(r),onClick:function(){return d(n,r)},size:"small",variant:"text",sx:{minWidth:"auto",px:1,py:.5,fontSize:"h1"===r?"1.1rem":"h2"===r?"1rem":"0.875rem",fontWeight:null!=r&&r.startsWith("h")?"bold":"normal",color:"#666","&:hover":{bgcolor:"#e0e0e0"},"&:active":{bgcolor:"#d5d5d5"}}},o)})),a.default.createElement(t.Divider,{orientation:"vertical",flexItem:!0,sx:{mx:1}}),a.default.createElement(t.Box,{sx:{display:"flex",alignItems:"center",gap:.5}},u.map(function(e){var n=e.command,r=e.icon,o=e.title;return a.default.createElement(t.Tooltip,{key:n,title:o},a.default.createElement(t.IconButton,{onClick:function(){return d(n)},size:"small",sx:{"&:hover":{bgcolor:"#e0e0e0"},"&:active":{bgcolor:"#d5d5d5"}}},a.default.createElement(r,{fontSize:"medium"})))})),a.default.createElement(t.Divider,{orientation:"vertical",flexItem:!0,sx:{mx:1}}),a.default.createElement(t.Box,{sx:{display:"flex",alignItems:"center",gap:.5}},[{command:"insertUnorderedList",label:"â€¢ List",group:"list"},{command:"insertOrderedList",label:"1. List",group:"list"},{command:"formatBlock",value:"blockquote",label:"Quote",group:"list"}].map(function(e){var n=e.command,r=e.value,o=e.label;return a.default.createElement(t.Button,{key:"".concat(n,"-").concat(r||"default"),onClick:function(){return d(n,r)},size:"small",variant:"text",sx:{px:1,py:.5,fontSize:"0.875rem",color:"#666","&:hover":{bgcolor:"#e0e0e0"},"&:active":{bgcolor:"#d5d5d5"}}},o)})))},p=n.makeStyles(function(e){return{paper:{border:"1px solid #e0e0e0",borderRadius:e.spacing(1),overflow:"hidden","&:focus-within":{borderColor:e.palette.primary.main}},editor:{padding:e.spacing(2),outline:"none","& p":{margin:"".concat(e.spacing(1),"px 0"),"&:first-child":{marginTop:0},"&:last-child":{marginBottom:0}},"& h1":{fontSize:"2rem",fontWeight:"bold",margin:"".concat(e.spacing(1.5),"px 0")},"& h2":{fontSize:"1.5rem",fontWeight:"bold",margin:"".concat(e.spacing(1),"px 0")},"& h3":{fontSize:"1.25rem",fontWeight:"bold",margin:"".concat(e.spacing(1),"px 0")},"& ul":{listStyle:"disc",paddingLeft:e.spacing(3),margin:"".concat(e.spacing(1),"px 0")},"& ol":{listStyle:"decimal",paddingLeft:e.spacing(3),margin:"".concat(e.spacing(1),"px 0")},"& li":{margin:"".concat(e.spacing(.5),"px 0")},"& blockquote":{borderLeft:"4px solid #ccc",paddingLeft:e.spacing(2),fontStyle:"italic",margin:"".concat(e.spacing(2),"px 0"),color:"#666"},"& a":{color:e.palette.primary.main,textDecoration:"underline","&:hover":{color:e.palette.primary.dark}},"& strong":{fontWeight:"bold"},"& em":{fontStyle:"italic"},"& u":{textDecoration:"underline"}},placeholder:{position:"absolute",top:16,left:16,color:"#999",pointerEvents:"none",userSelect:"none"}}});exports.applyFormatting=l,exports.cleanHTML=u,exports.default=function(n){var r=n.name,o=void 0===r?"":r,d=n.value,g=void 0===d?"":d,v=n.onChange,x=void 0===v?function(){}:v,h=n.placeholder,y=void 0===h?"Start typing...":h,b=n.maxChars,C=void 0===b?null:b,k=n.height,E=void 0===k?"auto":k,S=n.minHeight,B=void 0===S?"150px":S,L=n.maxHeight,R=void 0===L?null:L,w=n.sx,T=void 0===w?{}:w,A=n.style,I=p(),F=e.useRef(null),H=s(e.useState(!1),2),D=H[0],z=H[1],M=s(e.useState({x:0,y:0}),2),W=M[0],q=M[1],j=s(e.useState(""),2),U=j[0],N=j[1],K=s(e.useState(!1),2),O=K[0],P=K[1],_=s(e.useState(null),2),V=_[0],Q=_[1],X=s(e.useState(!1),2),Y=X[0],$=X[1];e.useEffect(function(){F.current&&g!==F.current.innerHTML&&(F.current.innerHTML=g)},[g]);var G=e.useCallback(function(){if(F.current&&x){var e=F.current.innerHTML;if(C){var t=c(e);t.length>C&&(e=u(t.slice(0,C)),F.current.innerHTML=e)}x({target:{name:o,value:e}})}},[x,o,C]),J=e.useCallback(function(e,t){var n;if("createLink"!==e){if("removeFormat"===e)return document.execCommand("removeFormat",!1,null),void G();l(e,t),"function"==typeof(null==F||null===(n=F.current)||void 0===n?void 0:n.focus)&&F.current.focus(),G()}else{var r=window.getSelection();if(r&&!r.isCollapsed){var o,a=r.getRangeAt(0).cloneRange();Q(a);var i=a.getBoundingClientRect(),c=null===(o=F.current)||void 0===o?void 0:o.getBoundingClientRect();c&&(q({x:i.left-c.left+i.width/2,y:i.bottom-c.top+5}),N(""),P(!1),z(!0))}else{var u=null==r?void 0:r.getRangeAt(0);if(u){var d;Q(u.cloneRange());var s=u.getBoundingClientRect(),m=null===(d=F.current)||void 0===d?void 0:d.getBoundingClientRect();m&&(q({x:s.left-m.left,y:s.bottom-m.top+5}),N(""),P(!1),z(!0))}}}},[G]),Z=e.useCallback(function(e){var t;i(e,V||void 0),z(!1),Q(null),"function"==typeof(null==F||null===(t=F.current)||void 0===t?void 0:t.focus)&&F.current.focus(),G()},[G,V]),ee=e.useCallback(function(e){var t=e.target;if("A"===t.tagName){var n;e.preventDefault();var r=t.getBoundingClientRect(),o=null===(n=F.current)||void 0===n?void 0:n.getBoundingClientRect();o&&(q({x:r.left-o.left+r.width/2,y:r.bottom-o.top+5}),N(t.getAttribute("href")||""),P(!0),z(!0))}else z(!1)},[]),te=e.useCallback(function(e){if(e.ctrlKey||e.metaKey)switch(e.key){case"b":e.preventDefault(),J("bold");break;case"i":e.preventDefault(),J("italic");break;case"u":e.preventDefault(),J("underline");break;case"k":e.preventDefault(),J("createLink");break;case"s":e.preventDefault(),J("strikeThrough");break;case"e":e.preventDefault(),J("removeFormat")}"Escape"===e.key&&(z(!1),Q(null))},[J]),ne=c(g),re=C?C-ne.length:null;return a.default.createElement(t.Paper,{elevation:1,className:I.paper,style:A,sx:T},a.default.createElement(f,{onFormat:J,showStrikethrough:!0,showCleanFormat:!0}),a.default.createElement(t.Box,{style:{position:"relative"}},a.default.createElement(t.Box,{ref:F,contentEditable:!0,onFocus:function(){return $(!0)},onBlur:function(){return $(!1)},onInput:G,onClick:ee,onKeyDown:te,className:I.editor,style:{minHeight:B,height:E,maxHeight:R,overflowY:R?"auto":void 0},suppressContentEditableWarning:!0}),(!F.current||""===F.current.innerHTML)&&!Y&&a.default.createElement(t.Box,{className:I.placeholder},y),D&&a.default.createElement(m,{position:W,onSubmit:Z,onClose:function(){z(!1),Q(null)},initialValue:U,isEdit:O}),C&&a.default.createElement(t.Box,{sx:{position:"absolute",right:8,bottom:4,fontSize:"0.75rem",color:re<0?"error.main":"text.secondary",pointerEvents:"none"}},re," characters remaining")))},exports.getCurrentBlockFormat=function(){return document.queryCommandValue("formatBlock")},exports.getPlainText=c,exports.getSelectionInfo=function(){var e=window.getSelection();if(!e||0===e.rangeCount)return null;var t=e.getRangeAt(0);return{selection:e,range:t.cloneRange(),text:e.toString(),isCollapsed:e.isCollapsed}},exports.insertHTML=function(e){var t=window.getSelection();if(t.rangeCount>0){var n=t.getRangeAt(0);n.deleteContents();var r=document.createElement("div");r.innerHTML=e;for(var o=document.createDocumentFragment();r.firstChild;)o.appendChild(r.firstChild);n.insertNode(o),n.collapse(!1),t.removeAllRanges(),t.addRange(n)}},exports.insertLink=i,exports.isFormatActive=function(e){return document.queryCommandState(e)},exports.removeLink=function(){document.execCommand("unlink")};
//# sourceMappingURL=index.js.map
